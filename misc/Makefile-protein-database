.PHONY: clean, clobber, download

# The following assumes you have run pip install dark-matter to install the
# Dark Matter tools (see https://github.com/acorg/dark-matter).

# Version 15 of RVDB, as on March 23, 2019. Note that we use the clustered
# version, not the unclustered.  Note that version 16 is now out.
RVDB := C-RVDBv15.1.fasta

DB := genomes-proteins.db
PROTEINS := proteins.fasta
ID_DIR := ids

$(PROTEINS):
	make-protein-database.py --databaseFile $(DB) --gb $(ID_DIR)/ids_*.genbank --databaseName refseq > $@

download-gb:
	egrep '^>' $(RVDB) | cut -f3 -d\| | download-genbank.sh $(ID_DIR)

clean:
	rm -f $(ID_DIR)/ids_[a-z][a-z][a-z][a-z][a-z] $(ID_DIR)/ids_[a-z][a-z][a-z][a-z][a-z].params *~

clobber: clean
	rm -f $(ID_DIR)/ids_[a-z][a-z][a-z][a-z][a-z].genbank $(DB) $(PROTEINS)

download:
	test -f $(RVDB) || curl -L -O 'https://hive.biochemistry.gwu.edu/prd/rvdb/content/$(RVDB)'
	chmod a-w $(RVDB)
